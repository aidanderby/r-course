---
title: "R Notebook"
output: html_notebook
---

# Day 1

## Intro to R

-  No activity, just encourage folks to go along with us, get comfortable
-  Still have short break

## Reading Data

-  Read in some data and plot (e.g.) NO2:NOx over time 
  - Date in different format to example
  - NO2:NOx needs calculating/adding w/ mutate

```{r}
met = read.csv(here::here("data/exercises/aberdeen_met.csv")) %>%
  mutate(date = lubridate::mdy_hms(date))

no  = read.csv(here::here("data/exercises/aberdeen_no.csv")) %>%
  mutate(date = lubridate::mdy_hms(date))

no2 = read.csv(here::here("data/exercises/aberdeen_no2.csv")) %>%
  mutate(date = lubridate::mdy_hms(date))

all = left_join(no, no2, by = "date") %>%
  left_join(met, by = "date") %>%
  mutate(nox = no + no2,
         no2_ratio = no2 / nox)

plot(x = all$date, y = all$no2_ratio)
```

## Basic Stats

-  Get the Nox/CO2 gradient from earlier data
-  Calculate the mean NOx:CO2

```{r}
mean(all$no2_ratio, na.rm = T)
median(all$no2_ratio, na.rm = T)
sd(all$no2_ratio, na.rm = T)

plot(all$nox, all$no2)

lm(formula = no2 ~ nox, data = all)
```


## openair

-  Open ended, go through openair manual, try out some of the plots that sound cool!

```{r}

openair::windRose(all)

openair::calendarPlot(all, year = 2019)

# etc.
```

# Day 2

## Reading many data

- Same data as yesterday, but Read it in with a loop!

```{r}

files = list.files(here::here("data/exercises"), full.names = T)

file_list = list()

for (i in 1:length(files)) {
  
  file_list[[i]] = read.csv(files[[i]]) %>%
    mutate(date = lubridate::mdy_hms(date))
    
}

all = file_list[[1]] %>%
  left_join(file_list[[2]], by = "date") %>%
  left_join(file_list[[3]], by = "date")

```

  
## Manipulation

- Use data, pivot longer, find mean and sd; find the max value for each species

```{r}

all %>%
  pivot_longer(c(no, ws, no2, air_temp)) %>%
  group_by(name) %>%
  summarise(mean = mean(value, na.rm = T),
            sd   = sd(value, na.rm = T))

all %>%
  pivot_longer(c(no, ws, no2, air_temp)) %>%
  group_by(name) %>%
  filter(value == max(value, na.rm = T))

# could go further - do by year?

```

## ggplot

- Plot something with the data you've got

```{r}
all %>%
  timeAverage(avg.time = "week") %>%
  mutate(nox = no + no2) %>%
  pivot_longer(c(no, no2, nox)) %>%
  ggplot(aes(x = date, y = value)) +
  geom_line(aes(color = name)) +
  facet_wrap(~name, ncol = 1)
```


## final exercise

-  Large, open ended exercise.

